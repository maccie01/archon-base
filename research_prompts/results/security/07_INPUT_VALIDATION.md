# Research Result: 07_INPUT_VALIDATION


# Input Validation Patterns with Zod

Created: 2025-10-14

Last Updated: 2025-10-14

## When to Validate Input

Validating input ensures that only well-formed, safe data enters your application. Always validate:

* Server-side: Never trust client data.
* Client-side: Provide immediate user feedback.
* At boundary layers: APIs, form submissions, file uploads.

Prefer *whitelisting* accepted values over blacklisting invalid patterns.

---

## Validation Fundamentals

* **Whitelist validation** : Define allowed types, shapes, and values.
* **Blacklist validation** : Reject known bad patterns (less secure).
* **Never trust client input** : Always re-validate on server.
* **Defense in depth** : Validate at both frontend and backend.

---

## Zod Schema Validation

Zod is a TypeScript-first schema validation library offering:

* Type inference
* Transformations and coercions
* Custom refinements
* Nested object and array schemas

## Basic Types

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">ts</div></div><div><span><code><span class="token token">import</span><span></span><span class="token token punctuation">{</span><span> z </span><span class="token token punctuation">}</span><span></span><span class="token token">from</span><span></span><span class="token token">'zod'</span><span class="token token punctuation">;</span><span>
</span>
<span></span><span class="token token">const</span><span> stringSchema </span><span class="token token operator">=</span><span> z</span><span class="token token punctuation">.</span><span class="token token">string</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token">const</span><span> numberSchema </span><span class="token token operator">=</span><span> z</span><span class="token token punctuation">.</span><span class="token token">number</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token">const</span><span> booleanSchema </span><span class="token token operator">=</span><span> z</span><span class="token token punctuation">.</span><span class="token token">boolean</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></code></span></div></div></div></pre>

## Common Validators

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">ts</div></div><div><span><code><span>z</span><span class="token token punctuation">.</span><span class="token token">string</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">min</span><span class="token token punctuation">(</span><span class="token token">3</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span></span><span class="token token">// length ≥3</span><span>
</span><span>z</span><span class="token token punctuation">.</span><span class="token token">string</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">email</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span></span><span class="token token">// valid email format</span><span>
</span><span>z</span><span class="token token punctuation">.</span><span class="token token">number</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">int</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">positive</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span></span><span class="token token">// positive integer</span><span>
</span><span>z</span><span class="token token punctuation">.</span><span class="token token">string</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">regex</span><span class="token token punctuation">(</span><span class="token token regex-delimiter">/</span><span class="token token regex-source language-regex">^[a-zA-Z]+$</span><span class="token token regex-delimiter">/</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span></span><span class="token token">// only letters</span><span>
</span></code></span></div></div></div></pre>

## Refinements and Transforms

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">ts</div></div><div><span><code><span class="token token">const</span><span> passwordSchema </span><span class="token token operator">=</span><span> z</span><span class="token token punctuation">.</span><span class="token token">string</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span>
</span><span></span><span class="token token punctuation">.</span><span class="token token">min</span><span class="token token punctuation">(</span><span class="token token">8</span><span class="token token punctuation">,</span><span></span><span class="token token">"Must be at least 8 characters"</span><span class="token token punctuation">)</span><span>
</span><span></span><span class="token token punctuation">.</span><span class="token token">refine</span><span class="token token punctuation">(</span><span>val </span><span class="token token operator">=></span><span></span><span class="token token regex-delimiter">/</span><span class="token token regex-source language-regex">[A-Z]</span><span class="token token regex-delimiter">/</span><span class="token token punctuation">.</span><span class="token token">test</span><span class="token token punctuation">(</span><span>val</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span></span><span class="token token punctuation">{</span><span> message</span><span class="token token operator">:</span><span></span><span class="token token">"Must include uppercase"</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span>
</span><span></span><span class="token token punctuation">.</span><span class="token token">transform</span><span class="token token punctuation">(</span><span>val </span><span class="token token operator">=></span><span> val</span><span class="token token punctuation">.</span><span class="token token">trim</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></code></span></div></div></div></pre>

## Nested Objects and Arrays

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">ts</div></div><div><span><code><span class="token token">const</span><span> profileSchema </span><span class="token token operator">=</span><span> z</span><span class="token token punctuation">.</span><span class="token token">object</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span>
</span><span>  username</span><span class="token token operator">:</span><span> z</span><span class="token token punctuation">.</span><span class="token token">string</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">min</span><span class="token token punctuation">(</span><span class="token token">3</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">max</span><span class="token token punctuation">(</span><span class="token token">30</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span>  roles</span><span class="token token operator">:</span><span> z</span><span class="token token punctuation">.</span><span class="token token">array</span><span class="token token punctuation">(</span><span>z</span><span class="token token punctuation">.</span><span class="token token">enum</span><span class="token token punctuation">(</span><span class="token token punctuation">[</span><span class="token token">'user'</span><span class="token token punctuation">,</span><span class="token token">'admin'</span><span class="token token punctuation">]</span><span class="token token punctuation">)</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">nonempty</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span>  address</span><span class="token token operator">:</span><span> z</span><span class="token token punctuation">.</span><span class="token token">object</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span>
</span><span>    street</span><span class="token token operator">:</span><span> z</span><span class="token token punctuation">.</span><span class="token token">string</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span>    zip</span><span class="token token operator">:</span><span> z</span><span class="token token punctuation">.</span><span class="token token">string</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">regex</span><span class="token token punctuation">(</span><span class="token token regex-delimiter">/</span><span class="token token regex-source language-regex">^\d{5}$</span><span class="token token regex-delimiter">/</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></code></span></div></div></div></pre>

---

## Express.js Middleware Validation

Centralize validation in middleware for clean route handlers.

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">ts</div></div><div><span><code><span class="token token">// src/middleware/validate.ts</span><span>
</span><span></span><span class="token token">import</span><span></span><span class="token token punctuation">{</span><span> Request</span><span class="token token punctuation">,</span><span> Response</span><span class="token token punctuation">,</span><span> NextFunction </span><span class="token token punctuation">}</span><span></span><span class="token token">from</span><span></span><span class="token token">'express'</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token">import</span><span></span><span class="token token punctuation">{</span><span> AnyZodObject</span><span class="token token punctuation">,</span><span> ZodError </span><span class="token token punctuation">}</span><span></span><span class="token token">from</span><span></span><span class="token token">'zod'</span><span class="token token punctuation">;</span><span>
</span>
<span></span><span class="token token">export</span><span></span><span class="token token">const</span><span></span><span class="token token function-variable">validate</span><span></span><span class="token token operator">=</span><span>
</span><span></span><span class="token token punctuation">(</span><span>schema</span><span class="token token operator">:</span><span> AnyZodObject</span><span class="token token punctuation">)</span><span></span><span class="token token operator">=></span><span>
</span><span></span><span class="token token punctuation">(</span><span>req</span><span class="token token operator">:</span><span> Request</span><span class="token token punctuation">,</span><span> res</span><span class="token token operator">:</span><span> Response</span><span class="token token punctuation">,</span><span> next</span><span class="token token operator">:</span><span> NextFunction</span><span class="token token punctuation">)</span><span></span><span class="token token operator">=></span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token">try</span><span></span><span class="token token punctuation">{</span><span>
</span><span>      schema</span><span class="token token punctuation">.</span><span class="token token">parse</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span>
</span><span>        body</span><span class="token token operator">:</span><span> req</span><span class="token token punctuation">.</span><span>body</span><span class="token token punctuation">,</span><span>
</span><span>        query</span><span class="token token operator">:</span><span> req</span><span class="token token punctuation">.</span><span>query</span><span class="token token punctuation">,</span><span>
</span><span>        params</span><span class="token token operator">:</span><span> req</span><span class="token token punctuation">.</span><span>params</span><span class="token token punctuation">,</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token">next</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span></span><span class="token token">catch</span><span></span><span class="token token punctuation">(</span><span>err</span><span class="token token punctuation">)</span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token">if</span><span></span><span class="token token punctuation">(</span><span>err </span><span class="token token">instanceof</span><span></span><span class="token token">ZodError</span><span class="token token punctuation">)</span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token">return</span><span> res</span><span class="token token punctuation">.</span><span class="token token">status</span><span class="token token punctuation">(</span><span class="token token">400</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">json</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span>
</span><span>          errors</span><span class="token token operator">:</span><span> err</span><span class="token token punctuation">.</span><span>errors</span><span class="token token punctuation">.</span><span class="token token">map</span><span class="token token punctuation">(</span><span>e </span><span class="token token operator">=></span><span></span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span>
</span><span>            path</span><span class="token token operator">:</span><span> e</span><span class="token token punctuation">.</span><span>path</span><span class="token token punctuation">.</span><span class="token token">join</span><span class="token token punctuation">(</span><span class="token token">'.'</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span>            message</span><span class="token token operator">:</span><span> e</span><span class="token token punctuation">.</span><span>message</span><span class="token token punctuation">,</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span>
</span><span></span><span class="token token">next</span><span class="token token punctuation">(</span><span>err</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">;</span><span>
</span></code></span></div></div></div></pre>

## Route Example

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">ts</div></div><div><span><code><span class="token token">import</span><span> express </span><span class="token token">from</span><span></span><span class="token token">'express'</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token">import</span><span></span><span class="token token punctuation">{</span><span> z </span><span class="token token punctuation">}</span><span></span><span class="token token">from</span><span></span><span class="token token">'zod'</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token">import</span><span></span><span class="token token punctuation">{</span><span> validate </span><span class="token token punctuation">}</span><span></span><span class="token token">from</span><span></span><span class="token token">'./middleware/validate'</span><span class="token token punctuation">;</span><span>
</span>
<span></span><span class="token token">const</span><span> router </span><span class="token token operator">=</span><span> express</span><span class="token token punctuation">.</span><span class="token token">Router</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span>
<span></span><span class="token token">const</span><span> createUserSchema </span><span class="token token operator">=</span><span> z</span><span class="token token punctuation">.</span><span class="token token">object</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span>
</span><span>  body</span><span class="token token operator">:</span><span> z</span><span class="token token punctuation">.</span><span class="token token">object</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span>
</span><span>    email</span><span class="token token operator">:</span><span> z</span><span class="token token punctuation">.</span><span class="token token">string</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">email</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span>    password</span><span class="token token operator">:</span><span> z</span><span class="token token punctuation">.</span><span class="token token">string</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">min</span><span class="token token punctuation">(</span><span class="token token">8</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span>    username</span><span class="token token operator">:</span><span> z</span><span class="token token punctuation">.</span><span class="token token">string</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">min</span><span class="token token punctuation">(</span><span class="token token">3</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span>
<span>router</span><span class="token token punctuation">.</span><span class="token token">post</span><span class="token token punctuation">(</span><span>
</span><span></span><span class="token token">'/users'</span><span class="token token punctuation">,</span><span>
</span><span></span><span class="token token">validate</span><span class="token token punctuation">(</span><span>createUserSchema</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span></span><span class="token token punctuation">(</span><span>req</span><span class="token token punctuation">,</span><span> res</span><span class="token token punctuation">)</span><span></span><span class="token token operator">=></span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token">// req.body is safe</span><span>
</span><span>    res</span><span class="token token punctuation">.</span><span class="token token">status</span><span class="token token punctuation">(</span><span class="token token">201</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">json</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span> success</span><span class="token token operator">:</span><span></span><span class="token token boolean">true</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span>
</span><span></span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></code></span></div></div></div></pre>

---

## React Hook Form + Zod Integration

Use `@hookform/resolvers/zod` for seamless validation.

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">tsx</div></div><div><span><code><span class="token token">// src/components/RegisterForm.tsx</span><span>
</span><span></span><span class="token token">import</span><span> React </span><span class="token token">from</span><span></span><span class="token token">'react'</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token">import</span><span></span><span class="token token punctuation">{</span><span> useForm </span><span class="token token punctuation">}</span><span></span><span class="token token">from</span><span></span><span class="token token">'react-hook-form'</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token">import</span><span></span><span class="token token punctuation">{</span><span> zodResolver </span><span class="token token punctuation">}</span><span></span><span class="token token">from</span><span></span><span class="token token">'@hookform/resolvers/zod'</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token">import</span><span></span><span class="token token punctuation">{</span><span> z </span><span class="token token punctuation">}</span><span></span><span class="token token">from</span><span></span><span class="token token">'zod'</span><span class="token token punctuation">;</span><span>
</span>
<span></span><span class="token token">const</span><span> formSchema </span><span class="token token operator">=</span><span> z</span><span class="token token punctuation">.</span><span class="token token">object</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span>
</span><span>  email</span><span class="token token operator">:</span><span> z</span><span class="token token punctuation">.</span><span class="token token">string</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">email</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span> message</span><span class="token token operator">:</span><span></span><span class="token token">'Invalid email'</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span>  password</span><span class="token token operator">:</span><span> z</span><span class="token token punctuation">.</span><span class="token token">string</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">min</span><span class="token token punctuation">(</span><span class="token token">8</span><span class="token token punctuation">,</span><span></span><span class="token token punctuation">{</span><span> message</span><span class="token token operator">:</span><span></span><span class="token token">'Min 8 chars'</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span>  age</span><span class="token token operator">:</span><span> z</span><span class="token token punctuation">.</span><span class="token token">number</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">int</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">positive</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span>
<span></span><span class="token token">type</span><span></span><span class="token token">FormData</span><span></span><span class="token token operator">=</span><span> z</span><span class="token token punctuation">.</span><span>infer</span><span class="token token operator"><</span><span class="token token">typeof</span><span> formSchema</span><span class="token token operator">></span><span class="token token punctuation">;</span><span>
</span>
<span></span><span class="token token">export</span><span></span><span class="token token">function</span><span></span><span class="token token">RegisterForm</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token">const</span><span></span><span class="token token punctuation">{</span><span>
</span><span>    register</span><span class="token token punctuation">,</span><span>
</span><span>    handleSubmit</span><span class="token token punctuation">,</span><span>
</span><span>    formState</span><span class="token token operator">:</span><span></span><span class="token token punctuation">{</span><span> errors </span><span class="token token punctuation">}</span><span class="token token punctuation">,</span><span>
</span><span></span><span class="token token punctuation">}</span><span></span><span class="token token operator">=</span><span></span><span class="token token generic-function">useForm</span><span class="token token generic-function generic operator"><</span><span class="token token generic-function generic">FormData</span><span class="token token generic-function generic operator">></span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span>
</span><span>    resolver</span><span class="token token operator">:</span><span></span><span class="token token">zodResolver</span><span class="token token punctuation">(</span><span>formSchema</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span>
<span></span><span class="token token">const</span><span></span><span class="token token function-variable">onSubmit</span><span></span><span class="token token operator">=</span><span></span><span class="token token punctuation">(</span><span>data</span><span class="token token operator">:</span><span> FormData</span><span class="token token punctuation">)</span><span></span><span class="token token operator">=></span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token">console</span><span class="token token punctuation">.</span><span class="token token">log</span><span class="token token punctuation">(</span><span>data</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">;</span><span>
</span>
<span></span><span class="token token">return</span><span></span><span class="token token punctuation">(</span><span>
</span><span></span><span class="token token operator"><</span><span>form onSubmit</span><span class="token token operator">=</span><span class="token token punctuation">{</span><span class="token token">handleSubmit</span><span class="token token punctuation">(</span><span>onSubmit</span><span class="token token punctuation">)</span><span class="token token punctuation">}</span><span class="token token operator">></span><span>
</span><span></span><span class="token token operator"><</span><span>div</span><span class="token token operator">></span><span>
</span><span></span><span class="token token operator"><</span><span>label</span><span class="token token operator">></span><span>Email</span><span class="token token operator"><</span><span class="token token operator">/</span><span>label</span><span class="token token operator">></span><span>
</span><span></span><span class="token token operator"><</span><span>input </span><span class="token token punctuation">{</span><span class="token token operator">...</span><span class="token token">register</span><span class="token token punctuation">(</span><span class="token token">'email'</span><span class="token token punctuation">)</span><span class="token token punctuation">}</span><span></span><span class="token token operator">/</span><span class="token token operator">></span><span>
</span><span></span><span class="token token punctuation">{</span><span>errors</span><span class="token token punctuation">.</span><span>email </span><span class="token token operator">&&</span><span></span><span class="token token operator"><</span><span>p</span><span class="token token operator">></span><span class="token token punctuation">{</span><span>errors</span><span class="token token punctuation">.</span><span>email</span><span class="token token punctuation">.</span><span>message</span><span class="token token punctuation">}</span><span class="token token operator"><</span><span class="token token operator">/</span><span>p</span><span class="token token operator">></span><span class="token token punctuation">}</span><span>
</span><span></span><span class="token token operator"><</span><span class="token token operator">/</span><span>div</span><span class="token token operator">></span><span>
</span><span></span><span class="token token operator"><</span><span>div</span><span class="token token operator">></span><span>
</span><span></span><span class="token token operator"><</span><span>label</span><span class="token token operator">></span><span>Password</span><span class="token token operator"><</span><span class="token token operator">/</span><span>label</span><span class="token token operator">></span><span>
</span><span></span><span class="token token operator"><</span><span>input type</span><span class="token token operator">=</span><span class="token token">"password"</span><span></span><span class="token token punctuation">{</span><span class="token token operator">...</span><span class="token token">register</span><span class="token token punctuation">(</span><span class="token token">'password'</span><span class="token token punctuation">)</span><span class="token token punctuation">}</span><span></span><span class="token token operator">/</span><span class="token token operator">></span><span>
</span><span></span><span class="token token punctuation">{</span><span>errors</span><span class="token token punctuation">.</span><span>password </span><span class="token token operator">&&</span><span></span><span class="token token operator"><</span><span>p</span><span class="token token operator">></span><span class="token token punctuation">{</span><span>errors</span><span class="token token punctuation">.</span><span>password</span><span class="token token punctuation">.</span><span>message</span><span class="token token punctuation">}</span><span class="token token operator"><</span><span class="token token operator">/</span><span>p</span><span class="token token operator">></span><span class="token token punctuation">}</span><span>
</span><span></span><span class="token token operator"><</span><span class="token token operator">/</span><span>div</span><span class="token token operator">></span><span>
</span><span></span><span class="token token operator"><</span><span>div</span><span class="token token operator">></span><span>
</span><span></span><span class="token token operator"><</span><span>label</span><span class="token token operator">></span><span>Age</span><span class="token token operator"><</span><span class="token token operator">/</span><span>label</span><span class="token token operator">></span><span>
</span><span></span><span class="token token operator"><</span><span>input type</span><span class="token token operator">=</span><span class="token token">"number"</span><span></span><span class="token token punctuation">{</span><span class="token token operator">...</span><span class="token token">register</span><span class="token token punctuation">(</span><span class="token token">'age'</span><span class="token token punctuation">,</span><span></span><span class="token token punctuation">{</span><span> valueAsNumber</span><span class="token token operator">:</span><span></span><span class="token token boolean">true</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">}</span><span></span><span class="token token operator">/</span><span class="token token operator">></span><span>
</span><span></span><span class="token token punctuation">{</span><span>errors</span><span class="token token punctuation">.</span><span>age </span><span class="token token operator">&&</span><span></span><span class="token token operator"><</span><span>p</span><span class="token token operator">></span><span class="token token punctuation">{</span><span>errors</span><span class="token token punctuation">.</span><span>age</span><span class="token token punctuation">.</span><span>message</span><span class="token token punctuation">}</span><span class="token token operator"><</span><span class="token token operator">/</span><span>p</span><span class="token token operator">></span><span class="token token punctuation">}</span><span>
</span><span></span><span class="token token operator"><</span><span class="token token operator">/</span><span>div</span><span class="token token operator">></span><span>
</span><span></span><span class="token token operator"><</span><span>button type</span><span class="token token operator">=</span><span class="token token">"submit"</span><span class="token token operator">></span><span>Register</span><span class="token token operator"><</span><span class="token token operator">/</span><span>button</span><span class="token token operator">></span><span>
</span><span></span><span class="token token operator"><</span><span class="token token operator">/</span><span>form</span><span class="token token operator">></span><span>
</span><span></span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span>
</span></code></span></div></div></div></pre>

---

## File Upload Validation

Validate file type and size before processing.

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">ts</div></div><div><span><code><span class="token token">import</span><span> multer </span><span class="token token">from</span><span></span><span class="token token">'multer'</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token">import</span><span></span><span class="token token punctuation">{</span><span> z </span><span class="token token punctuation">}</span><span></span><span class="token token">from</span><span></span><span class="token token">'zod'</span><span class="token token punctuation">;</span><span>
</span>
<span></span><span class="token token">// Multer setup</span><span>
</span><span></span><span class="token token">const</span><span> upload </span><span class="token token operator">=</span><span></span><span class="token token">multer</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span>
</span><span>  limits</span><span class="token token operator">:</span><span></span><span class="token token punctuation">{</span><span> fileSize</span><span class="token token operator">:</span><span></span><span class="token token">2</span><span></span><span class="token token operator">*</span><span></span><span class="token token">1024</span><span></span><span class="token token operator">*</span><span></span><span class="token token">1024</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">,</span><span></span><span class="token token">// 2 MB</span><span>
</span><span></span><span class="token token function-variable">fileFilter</span><span class="token token operator">:</span><span></span><span class="token token punctuation">(</span><span>req</span><span class="token token punctuation">,</span><span> file</span><span class="token token punctuation">,</span><span> cb</span><span class="token token punctuation">)</span><span></span><span class="token token operator">=></span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token">if</span><span></span><span class="token token punctuation">(</span><span class="token token operator">!</span><span>file</span><span class="token token punctuation">.</span><span>mimetype</span><span class="token token punctuation">.</span><span class="token token">startsWith</span><span class="token token punctuation">(</span><span class="token token">'image/'</span><span class="token token punctuation">)</span><span class="token token punctuation">)</span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token">return</span><span></span><span class="token token">cb</span><span class="token token punctuation">(</span><span class="token token">new</span><span></span><span class="token token">Error</span><span class="token token punctuation">(</span><span class="token token">'Only images allowed'</span><span class="token token punctuation">)</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span>
</span><span></span><span class="token token">cb</span><span class="token token punctuation">(</span><span class="token token">null</span><span class="token token punctuation">,</span><span></span><span class="token token boolean">true</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">,</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span>
<span></span><span class="token token">const</span><span> fileMetadataSchema </span><span class="token token operator">=</span><span> z</span><span class="token token punctuation">.</span><span class="token token">object</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span>
</span><span>  filename</span><span class="token token operator">:</span><span> z</span><span class="token token punctuation">.</span><span class="token token">string</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span>  mimetype</span><span class="token token operator">:</span><span> z</span><span class="token token punctuation">.</span><span class="token token">enum</span><span class="token token punctuation">(</span><span class="token token punctuation">[</span><span class="token token">'image/jpeg'</span><span class="token token punctuation">,</span><span></span><span class="token token">'image/png'</span><span class="token token punctuation">]</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span>  size</span><span class="token token operator">:</span><span> z</span><span class="token token punctuation">.</span><span class="token token">number</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">max</span><span class="token token punctuation">(</span><span class="token token">2</span><span></span><span class="token token operator">*</span><span></span><span class="token token">1024</span><span></span><span class="token token operator">*</span><span></span><span class="token token">1024</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span>
<span>router</span><span class="token token punctuation">.</span><span class="token token">post</span><span class="token token punctuation">(</span><span>
</span><span></span><span class="token token">'/upload'</span><span class="token token punctuation">,</span><span>
</span><span>  upload</span><span class="token token punctuation">.</span><span class="token token">single</span><span class="token token punctuation">(</span><span class="token token">'file'</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span></span><span class="token token punctuation">(</span><span>req</span><span class="token token punctuation">,</span><span> res</span><span class="token token punctuation">,</span><span> next</span><span class="token token punctuation">)</span><span></span><span class="token token operator">=></span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token">try</span><span></span><span class="token token punctuation">{</span><span>
</span><span>      fileMetadataSchema</span><span class="token token punctuation">.</span><span class="token token">parse</span><span class="token token punctuation">(</span><span>req</span><span class="token token punctuation">.</span><span>file</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span>      res</span><span class="token token punctuation">.</span><span class="token token">json</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span> success</span><span class="token token operator">:</span><span></span><span class="token token boolean">true</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span></span><span class="token token">catch</span><span></span><span class="token token punctuation">(</span><span>err</span><span class="token token punctuation">)</span><span></span><span class="token token punctuation">{</span><span>
</span><span>      res</span><span class="token token punctuation">.</span><span class="token token">status</span><span class="token token punctuation">(</span><span class="token token">400</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">json</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span> error</span><span class="token token operator">:</span><span></span><span class="token token">'Invalid file upload'</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span>
</span><span></span><span class="token token punctuation">}</span><span>
</span><span></span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></code></span></div></div></div></pre>

---

## Type Coercion Dangers

* `z.coerce.number()`: converts strings to numbers; use with caution.
* Unintended transforms may hide invalid input; always validate upstream.

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">ts</div></div><div><span><code><span class="token token">const</span><span> coercedSchema </span><span class="token token operator">=</span><span> z</span><span class="token token punctuation">.</span><span class="token token">object</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span>
</span><span>  count</span><span class="token token operator">:</span><span> z</span><span class="token token punctuation">.</span><span>coerce</span><span class="token token punctuation">.</span><span class="token token">number</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">int</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">positive</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></code></span></div></div></div></pre>

---

## Common Validation Bypass Techniques

1. **Sending additional properties** : Strip unknown keys.

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">ts</div></div><div><span><code><span>z</span><span class="token token punctuation">.</span><span class="token token">object</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span> a</span><span class="token token operator">:</span><span> z</span><span class="token token punctuation">.</span><span class="token token">string</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">strict</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
   </span></code></span></div></div></div></pre>

1. **Deep tampering** : Ensure nested schemas with strict mode.
2. **Invalid types in JSON** : Validate with correct `coerce` and `refine`.
3. **Bypassing client checks** : Always enforce backend.

---

## Error Handling and User Feedback

* Return structured error objects: `[{ path: 'body.email', message: 'Invalid email' }]`.
* Map errors to form fields for friendly messages.
* Avoid leaking stack traces or sensitive data.

---

## Anti-Patterns

## ❌ DON'T: Rely on Frontend Only

Bypassed via direct API calls.

## ❌ DON'T: Blacklist Inputs

Attackers may craft unknown payloads.

## ❌ DON'T: Skip Nested Validation

Unchecked nested objects lead to injection risks.

---

## Testing Validation

## Unit Tests with Jest

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">ts</div></div><div><span><code><span class="token token">import</span><span></span><span class="token token punctuation">{</span><span> z </span><span class="token token punctuation">}</span><span></span><span class="token token">from</span><span></span><span class="token token">'zod'</span><span class="token token punctuation">;</span><span>
</span>
<span></span><span class="token token">const</span><span> schema </span><span class="token token operator">=</span><span> z</span><span class="token token punctuation">.</span><span class="token token">object</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span>
</span><span>  username</span><span class="token token operator">:</span><span> z</span><span class="token token punctuation">.</span><span class="token token">string</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">min</span><span class="token token punctuation">(</span><span class="token token">3</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span>
<span></span><span class="token token">describe</span><span class="token token punctuation">(</span><span class="token token">'Validation'</span><span class="token token punctuation">,</span><span></span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span></span><span class="token token operator">=></span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token">it</span><span class="token token punctuation">(</span><span class="token token">'accepts valid input'</span><span class="token token punctuation">,</span><span></span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span></span><span class="token token operator">=></span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token">expect</span><span class="token token punctuation">(</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span></span><span class="token token operator">=></span><span> schema</span><span class="token token punctuation">.</span><span class="token token">parse</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span> username</span><span class="token token operator">:</span><span></span><span class="token token">'abc'</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span>not</span><span class="token token punctuation">.</span><span class="token token">toThrow</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token">it</span><span class="token token punctuation">(</span><span class="token token">'rejects short username'</span><span class="token token punctuation">,</span><span></span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span></span><span class="token token operator">=></span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token">expect</span><span class="token token punctuation">(</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span></span><span class="token token operator">=></span><span> schema</span><span class="token token punctuation">.</span><span class="token token">parse</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span> username</span><span class="token token operator">:</span><span></span><span class="token token">'ab'</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">toThrow</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></code></span></div></div></div></pre>

## Integration Tests with Supertest

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">ts</div></div><div><span><code><span class="token token">import</span><span> request </span><span class="token token">from</span><span></span><span class="token token">'supertest'</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token">import</span><span> app </span><span class="token token">from</span><span></span><span class="token token">'../src/app'</span><span class="token token punctuation">;</span><span>
</span>
<span></span><span class="token token">describe</span><span class="token token punctuation">(</span><span class="token token">'POST /users'</span><span class="token token punctuation">,</span><span></span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span></span><span class="token token operator">=></span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token">it</span><span class="token token punctuation">(</span><span class="token token">'returns 400 for missing email'</span><span class="token token punctuation">,</span><span></span><span class="token token">async</span><span></span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span></span><span class="token token operator">=></span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token">const</span><span> res </span><span class="token token operator">=</span><span></span><span class="token token">await</span><span></span><span class="token token">request</span><span class="token token punctuation">(</span><span>app</span><span class="token token punctuation">)</span><span>
</span><span></span><span class="token token punctuation">.</span><span class="token token">post</span><span class="token token punctuation">(</span><span class="token token">'/users'</span><span class="token token punctuation">)</span><span>
</span><span></span><span class="token token punctuation">.</span><span class="token token">send</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span> password</span><span class="token token operator">:</span><span></span><span class="token token">'password123'</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token">expect</span><span class="token token punctuation">(</span><span>res</span><span class="token token punctuation">.</span><span>status</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">toBe</span><span class="token token punctuation">(</span><span class="token token">400</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token">expect</span><span class="token token punctuation">(</span><span>res</span><span class="token token punctuation">.</span><span>body</span><span class="token token punctuation">.</span><span>errors</span><span class="token token punctuation">[</span><span class="token token">0</span><span class="token token punctuation">]</span><span class="token token punctuation">.</span><span>path</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">toBe</span><span class="token token punctuation">(</span><span class="token token">'body.email'</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></code></span></div></div></div></pre>

---

This document covers core patterns, secure defaults, and practical code examples for Zod-based input validation across Express.js APIs and React forms.
