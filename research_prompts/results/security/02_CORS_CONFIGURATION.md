# Research Result: 02_CORS_CONFIGURATION


# CORS Configuration

Created: 2025-10-14

Last Updated: 2025-10-14

## What is CORS?

Cross-Origin Resource Sharing (CORS) is a browser security mechanism that controls how web applications hosted on one origin (scheme, host, port) can request resources from another origin. It exists to enforce the Same-Origin Policy, which by default restricts scripts on a web page from making requests to a different origin than the one that served the page. CORS provides a controlled way to relax that policy when legitimate cross-origin communication is required.

## When Do You Need CORS?

CORS is necessary whenever a Single Page Application (SPA), mobile app, or other frontend client served from one origin (e.g., `https://app.example.com`) needs to consume an API hosted on another origin (e.g., `https://api.example.com`). Without appropriate CORS headers, browsers will block these cross-origin requests.

## CORS Headers Reference

| Header                           | Purpose                                                              | Example                                 |
| -------------------------------- | -------------------------------------------------------------------- | --------------------------------------- |
| Access-Control-Allow-Origin      | Specifies permitted origin(s)                                        | `https://app.example.com`             |
| Access-Control-Allow-Methods     | HTTP methods allowed in CORS requests                                | `GET, POST, PUT, DELETE, OPTIONS`     |
| Access-Control-Allow-Headers     | Custom headers allowed in requests                                   | `Content-Type, Authorization`         |
| Access-Control-Allow-Credentials | Indicates whether cookies/authentication allowed                     | `true`                                |
| Access-Control-Max-Age           | How long browsers may cache preflight response (in seconds)          | `600`                                 |
| Access-Control-Expose-Headers    | Response headers accessible to the client beyond the basic safe list | `X-RateLimit-Remaining, X-Request-ID` |

## Preflight Requests

## What Triggers a Preflight?

Browsers send an OPTIONS “preflight” request when the actual request:

* Uses methods other than GET, HEAD, or POST
* Includes custom headers not in the simple safe-list
* Specifies `Content-Type` other than `application/x-www-form-urlencoded`, `multipart/form-data`, or `text/plain`

## Handling OPTIONS Requests

Express.js must respond to OPTIONS with appropriate CORS headers and status code 204:

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">typescript</div></div><div><span><code><span class="token token">import</span><span> express </span><span class="token token">from</span><span></span><span class="token token">'express'</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token">import</span><span> cors </span><span class="token token">from</span><span></span><span class="token token">'cors'</span><span class="token token punctuation">;</span><span>
</span>
<span></span><span class="token token">const</span><span> app </span><span class="token token operator">=</span><span></span><span class="token token">express</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span>app</span><span class="token token punctuation">.</span><span class="token token">options</span><span class="token token punctuation">(</span><span class="token token">'*'</span><span class="token token punctuation">,</span><span></span><span class="token token">cors</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span></span><span class="token token">// enable preflight for all routes</span><span>
</span></code></span></div></div></div></pre>

Set caching to reduce preflight frequency:

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">typescript</div></div><div><span><code><span>app</span><span class="token token punctuation">.</span><span class="token token">use</span><span class="token token punctuation">(</span><span class="token token">cors</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span>
</span><span>  origin</span><span class="token token operator">:</span><span> process</span><span class="token token punctuation">.</span><span>env</span><span class="token token punctuation">.</span><span class="token token constant">ALLOWED_ORIGINS</span><span class="token token operator">?.</span><span class="token token">split</span><span class="token token punctuation">(</span><span class="token token">','</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span>  methods</span><span class="token token operator">:</span><span></span><span class="token token punctuation">[</span><span class="token token">'GET'</span><span class="token token punctuation">,</span><span class="token token">'POST'</span><span class="token token punctuation">,</span><span class="token token">'PUT'</span><span class="token token punctuation">,</span><span class="token token">'DELETE'</span><span class="token token punctuation">,</span><span class="token token">'OPTIONS'</span><span class="token token punctuation">]</span><span class="token token punctuation">,</span><span>
</span><span>  allowedHeaders</span><span class="token token operator">:</span><span></span><span class="token token punctuation">[</span><span class="token token">'Content-Type'</span><span class="token token punctuation">,</span><span class="token token">'Authorization'</span><span class="token token punctuation">]</span><span class="token token punctuation">,</span><span>
</span><span>  maxAge</span><span class="token token operator">:</span><span></span><span class="token token">600</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></code></span></div></div></div></pre>

## Origin Whitelisting

## Dynamic Origin Validation

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">typescript</div></div><div><span><code><span class="token token">import</span><span> cors</span><span class="token token punctuation">,</span><span></span><span class="token token punctuation">{</span><span> CorsOptions </span><span class="token token punctuation">}</span><span></span><span class="token token">from</span><span></span><span class="token token">'cors'</span><span class="token token punctuation">;</span><span>
</span>
<span></span><span class="token token">const</span><span> allowedOrigins </span><span class="token token operator">=</span><span></span><span class="token token punctuation">[</span><span>
</span><span></span><span class="token token">'https://app.example.com'</span><span class="token token punctuation">,</span><span>
</span><span></span><span class="token token">'https://admin.example.com'</span><span>
</span><span></span><span class="token token punctuation">]</span><span class="token token punctuation">;</span><span>
</span>
<span></span><span class="token token">const</span><span> corsOptions</span><span class="token token operator">:</span><span> CorsOptions </span><span class="token token operator">=</span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token function-variable">origin</span><span class="token token operator">:</span><span></span><span class="token token punctuation">(</span><span>origin</span><span class="token token punctuation">,</span><span> callback</span><span class="token token punctuation">)</span><span></span><span class="token token operator">=></span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token">if</span><span></span><span class="token token punctuation">(</span><span class="token token operator">!</span><span>origin </span><span class="token token operator">||</span><span> allowedOrigins</span><span class="token token punctuation">.</span><span class="token token">includes</span><span class="token token punctuation">(</span><span>origin</span><span class="token token punctuation">)</span><span class="token token punctuation">)</span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token">callback</span><span class="token token punctuation">(</span><span class="token token">null</span><span class="token token punctuation">,</span><span></span><span class="token token boolean">true</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span></span><span class="token token">else</span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token">callback</span><span class="token token punctuation">(</span><span class="token token">new</span><span></span><span class="token token">Error</span><span class="token token punctuation">(</span><span class="token token">'Not allowed by CORS'</span><span class="token token punctuation">)</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">,</span><span>
</span><span>  credentials</span><span class="token token operator">:</span><span></span><span class="token token boolean">true</span><span class="token token punctuation">,</span><span>
</span><span>  methods</span><span class="token token operator">:</span><span></span><span class="token token punctuation">[</span><span class="token token">'GET'</span><span class="token token punctuation">,</span><span class="token token">'POST'</span><span class="token token punctuation">,</span><span class="token token">'PUT'</span><span class="token token punctuation">,</span><span class="token token">'DELETE'</span><span class="token token punctuation">,</span><span class="token token">'OPTIONS'</span><span class="token token punctuation">]</span><span class="token token punctuation">,</span><span>
</span><span>  allowedHeaders</span><span class="token token operator">:</span><span></span><span class="token token punctuation">[</span><span class="token token">'Content-Type'</span><span class="token token punctuation">,</span><span class="token token">'Authorization'</span><span class="token token punctuation">]</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">;</span><span>
</span>
<span>app</span><span class="token token punctuation">.</span><span class="token token">use</span><span class="token token punctuation">(</span><span class="token token">cors</span><span class="token token punctuation">(</span><span>corsOptions</span><span class="token token punctuation">)</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></code></span></div></div></div></pre>

## Wildcard (`*`) Dangers

Using `*` permits any origin, exposing APIs to potential abuse. Especially avoid it when `credentials: true`.

## Subdomain Handling

Allow subdomains via dynamic regex validation:

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">typescript</div></div><div><span><code><span class="token token function-variable">origin</span><span class="token token operator">:</span><span></span><span class="token token punctuation">(</span><span>origin</span><span class="token token punctuation">,</span><span> callback</span><span class="token token punctuation">)</span><span></span><span class="token token operator">=></span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token">const</span><span> whitelistRegex </span><span class="token token operator">=</span><span></span><span class="token token regex-delimiter">/</span><span class="token token regex-source language-regex">^https:\/\/(app|admin)\.example\.com$</span><span class="token token regex-delimiter">/</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token">if</span><span></span><span class="token token punctuation">(</span><span class="token token operator">!</span><span>origin </span><span class="token token operator">||</span><span> whitelistRegex</span><span class="token token punctuation">.</span><span class="token token">test</span><span class="token token punctuation">(</span><span>origin</span><span class="token token punctuation">)</span><span class="token token punctuation">)</span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token">callback</span><span class="token token punctuation">(</span><span class="token token">null</span><span class="token token punctuation">,</span><span></span><span class="token token boolean">true</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span></span><span class="token token">else</span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token">callback</span><span class="token token punctuation">(</span><span class="token token">new</span><span></span><span class="token token">Error</span><span class="token token punctuation">(</span><span class="token token">'CORS not allowed'</span><span class="token token punctuation">)</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span>
</span><span></span><span class="token token punctuation">}</span><span>
</span></code></span></div></div></div></pre>

## Credentials and Cookies

When `Access-Control-Allow-Credentials: true`, browsers include cookies, HTTP authentication, or client SSL certificates in requests. Credentials require a specific origin—wildcards are not permitted.

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">typescript</div></div><div><span><code><span>app</span><span class="token token punctuation">.</span><span class="token token">use</span><span class="token token punctuation">(</span><span class="token token">cors</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span>
</span><span>  origin</span><span class="token token operator">:</span><span></span><span class="token token">'https://app.example.com'</span><span class="token token punctuation">,</span><span>
</span><span>  credentials</span><span class="token token operator">:</span><span></span><span class="token token boolean">true</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></code></span></div></div></div></pre>

Ensure server sets `Set-Cookie` with `SameSite=None; Secure`.

## Express.js Implementation

## Basic CORS Setup

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">typescript</div></div><div><span><code><span class="token token">import</span><span> express </span><span class="token token">from</span><span></span><span class="token token">'express'</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token">import</span><span> cors </span><span class="token token">from</span><span></span><span class="token token">'cors'</span><span class="token token punctuation">;</span><span>
</span>
<span></span><span class="token token">const</span><span> app </span><span class="token token operator">=</span><span></span><span class="token token">express</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span>
<span>app</span><span class="token token punctuation">.</span><span class="token token">use</span><span class="token token punctuation">(</span><span class="token token">cors</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span>
</span><span>  origin</span><span class="token token operator">:</span><span> process</span><span class="token token punctuation">.</span><span>env</span><span class="token token punctuation">.</span><span class="token token constant">ALLOWED_ORIGINS</span><span class="token token operator">?.</span><span class="token token">split</span><span class="token token punctuation">(</span><span class="token token">','</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span>  credentials</span><span class="token token operator">:</span><span></span><span class="token token boolean">true</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span>
<span>app</span><span class="token token punctuation">.</span><span class="token token">get</span><span class="token token punctuation">(</span><span class="token token">'/data'</span><span class="token token punctuation">,</span><span></span><span class="token token punctuation">(</span><span>req</span><span class="token token punctuation">,</span><span> res</span><span class="token token punctuation">)</span><span></span><span class="token token operator">=></span><span></span><span class="token token punctuation">{</span><span>
</span><span>  res</span><span class="token token punctuation">.</span><span class="token token">json</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span> message</span><span class="token token operator">:</span><span></span><span class="token token">'Hello, CORS!'</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></code></span></div></div></div></pre>

## Route-Specific CORS

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">typescript</div></div><div><span><code><span class="token token">import</span><span> strictCorsOptions </span><span class="token token">from</span><span></span><span class="token token">'./config/strictCors'</span><span class="token token punctuation">;</span><span>
</span>
<span>app</span><span class="token token punctuation">.</span><span class="token token">get</span><span class="token token punctuation">(</span><span class="token token">'/public'</span><span class="token token punctuation">,</span><span></span><span class="token token">cors</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span></span><span class="token token punctuation">(</span><span>req</span><span class="token token punctuation">,</span><span> res</span><span class="token token punctuation">)</span><span></span><span class="token token operator">=></span><span></span><span class="token token punctuation">{</span><span>
</span><span>  res</span><span class="token token punctuation">.</span><span class="token token">send</span><span class="token token punctuation">(</span><span class="token token">'Public data'</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span>
<span>app</span><span class="token token punctuation">.</span><span class="token token">post</span><span class="token token punctuation">(</span><span class="token token">'/admin'</span><span class="token token punctuation">,</span><span></span><span class="token token">cors</span><span class="token token punctuation">(</span><span>strictCorsOptions</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span></span><span class="token token punctuation">(</span><span>req</span><span class="token token punctuation">,</span><span> res</span><span class="token token punctuation">)</span><span></span><span class="token token operator">=></span><span></span><span class="token token punctuation">{</span><span>
</span><span>  res</span><span class="token token punctuation">.</span><span class="token token">send</span><span class="token token punctuation">(</span><span class="token token">'Admin data'</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></code></span></div></div></div></pre>

## Custom CORS Middleware

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">typescript</div></div><div><span><code><span class="token token">import</span><span></span><span class="token token punctuation">{</span><span> Request</span><span class="token token punctuation">,</span><span> Response</span><span class="token token punctuation">,</span><span> NextFunction </span><span class="token token punctuation">}</span><span></span><span class="token token">from</span><span></span><span class="token token">'express'</span><span class="token token punctuation">;</span><span>
</span>
<span></span><span class="token token">function</span><span></span><span class="token token">customCors</span><span class="token token punctuation">(</span><span>req</span><span class="token token operator">:</span><span> Request</span><span class="token token punctuation">,</span><span> res</span><span class="token token operator">:</span><span> Response</span><span class="token token punctuation">,</span><span> next</span><span class="token token operator">:</span><span> NextFunction</span><span class="token token punctuation">)</span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token">const</span><span> origin </span><span class="token token operator">=</span><span> req</span><span class="token token punctuation">.</span><span>headers</span><span class="token token punctuation">.</span><span>origin </span><span class="token token">as</span><span></span><span class="token token">string</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token">if</span><span></span><span class="token token punctuation">(</span><span>process</span><span class="token token punctuation">.</span><span>env</span><span class="token token punctuation">.</span><span class="token token constant">ALLOWED_ORIGINS</span><span class="token token operator">!</span><span class="token token punctuation">.</span><span class="token token">split</span><span class="token token punctuation">(</span><span class="token token">','</span><span class="token token punctuation">)</span><span class="token token punctuation">.</span><span class="token token">includes</span><span class="token token punctuation">(</span><span>origin</span><span class="token token punctuation">)</span><span class="token token punctuation">)</span><span></span><span class="token token punctuation">{</span><span>
</span><span>    res</span><span class="token token punctuation">.</span><span class="token token">header</span><span class="token token punctuation">(</span><span class="token token">'Access-Control-Allow-Origin'</span><span class="token token punctuation">,</span><span> origin</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span>    res</span><span class="token token punctuation">.</span><span class="token token">header</span><span class="token token punctuation">(</span><span class="token token">'Access-Control-Allow-Methods'</span><span class="token token punctuation">,</span><span class="token token">'GET,POST,PUT,DELETE,OPTIONS'</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span>    res</span><span class="token token punctuation">.</span><span class="token token">header</span><span class="token token punctuation">(</span><span class="token token">'Access-Control-Allow-Headers'</span><span class="token token punctuation">,</span><span class="token token">'Content-Type,Authorization'</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span>    res</span><span class="token token punctuation">.</span><span class="token token">header</span><span class="token token punctuation">(</span><span class="token token">'Access-Control-Allow-Credentials'</span><span class="token token punctuation">,</span><span class="token token">'true'</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token">if</span><span></span><span class="token token punctuation">(</span><span>req</span><span class="token token punctuation">.</span><span>method </span><span class="token token operator">===</span><span></span><span class="token token">'OPTIONS'</span><span class="token token punctuation">)</span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token">return</span><span> res</span><span class="token token punctuation">.</span><span class="token token">sendStatus</span><span class="token token punctuation">(</span><span class="token token">204</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span>
</span><span></span><span class="token token punctuation">}</span><span>
</span><span></span><span class="token token">next</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span>
</span>
<span>app</span><span class="token token punctuation">.</span><span class="token token">use</span><span class="token token punctuation">(</span><span>customCors</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></code></span></div></div></div></pre>

## Environment-Based Configuration

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">typescript</div></div><div><span><code><span class="token token">// config/cors.ts</span><span>
</span><span></span><span class="token token">import</span><span></span><span class="token token punctuation">{</span><span> CorsOptions </span><span class="token token punctuation">}</span><span></span><span class="token token">from</span><span></span><span class="token token">'cors'</span><span class="token token punctuation">;</span><span>
</span>
<span></span><span class="token token">export</span><span></span><span class="token token">const</span><span> getCorsOptions </span><span class="token token operator">=</span><span></span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token operator">:</span><span> CorsOptions </span><span class="token token operator">=></span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token">if</span><span></span><span class="token token punctuation">(</span><span>process</span><span class="token token punctuation">.</span><span>env</span><span class="token token punctuation">.</span><span class="token token constant">NODE_ENV</span><span></span><span class="token token operator">===</span><span></span><span class="token token">'development'</span><span class="token token punctuation">)</span><span></span><span class="token token punctuation">{</span><span>
</span><span></span><span class="token token">return</span><span></span><span class="token token punctuation">{</span><span>
</span><span>      origin</span><span class="token token operator">:</span><span></span><span class="token token">'*'</span><span class="token token punctuation">,</span><span>
</span><span>      methods</span><span class="token token operator">:</span><span></span><span class="token token punctuation">[</span><span class="token token">'GET'</span><span class="token token punctuation">,</span><span class="token token">'POST'</span><span class="token token punctuation">,</span><span class="token token">'PUT'</span><span class="token token punctuation">,</span><span class="token token">'DELETE'</span><span class="token token punctuation">,</span><span class="token token">'OPTIONS'</span><span class="token token punctuation">]</span><span class="token token punctuation">,</span><span>
</span><span>      allowedHeaders</span><span class="token token operator">:</span><span></span><span class="token token punctuation">[</span><span class="token token">'*'</span><span class="token token punctuation">]</span><span class="token token punctuation">,</span><span>
</span><span>      credentials</span><span class="token token operator">:</span><span></span><span class="token token boolean">true</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span>
</span><span></span><span class="token token">return</span><span></span><span class="token token punctuation">{</span><span>
</span><span>    origin</span><span class="token token operator">:</span><span> process</span><span class="token token punctuation">.</span><span>env</span><span class="token token punctuation">.</span><span class="token token constant">ALLOWED_ORIGINS</span><span class="token token operator">?.</span><span class="token token">split</span><span class="token token punctuation">(</span><span class="token token">','</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span>    methods</span><span class="token token operator">:</span><span></span><span class="token token punctuation">[</span><span class="token token">'GET'</span><span class="token token punctuation">,</span><span class="token token">'POST'</span><span class="token token punctuation">,</span><span class="token token">'PUT'</span><span class="token token punctuation">,</span><span class="token token">'DELETE'</span><span class="token token punctuation">,</span><span class="token token">'OPTIONS'</span><span class="token token punctuation">]</span><span class="token token punctuation">,</span><span>
</span><span>    allowedHeaders</span><span class="token token operator">:</span><span></span><span class="token token punctuation">[</span><span class="token token">'Content-Type'</span><span class="token token punctuation">,</span><span class="token token">'Authorization'</span><span class="token token punctuation">]</span><span class="token token punctuation">,</span><span>
</span><span>    credentials</span><span class="token token operator">:</span><span></span><span class="token token boolean">true</span><span class="token token punctuation">,</span><span>
</span><span>    maxAge</span><span class="token token operator">:</span><span></span><span class="token token">300</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">;</span><span>
</span></code></span></div></div></div></pre>

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">typescript</div></div><div><span><code><span class="token token">import</span><span> cors </span><span class="token token">from</span><span></span><span class="token token">'cors'</span><span class="token token punctuation">;</span><span>
</span><span></span><span class="token token">import</span><span></span><span class="token token punctuation">{</span><span> getCorsOptions </span><span class="token token punctuation">}</span><span></span><span class="token token">from</span><span></span><span class="token token">'./config/cors'</span><span class="token token punctuation">;</span><span>
</span>
<span>app</span><span class="token token punctuation">.</span><span class="token token">use</span><span class="token token punctuation">(</span><span class="token token">cors</span><span class="token token punctuation">(</span><span class="token token">getCorsOptions</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span class="token token punctuation">)</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></code></span></div></div></div></pre>

## Configuration Patterns

## Development Configuration

Relaxed settings to ease local testing:

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">typescript</div></div><div><span><code><span>app</span><span class="token token punctuation">.</span><span class="token token">use</span><span class="token token punctuation">(</span><span class="token token">cors</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span>
</span><span>  origin</span><span class="token token operator">:</span><span></span><span class="token token">'*'</span><span class="token token punctuation">,</span><span>
</span><span>  methods</span><span class="token token operator">:</span><span></span><span class="token token punctuation">[</span><span class="token token">'GET'</span><span class="token token punctuation">,</span><span class="token token">'POST'</span><span class="token token punctuation">,</span><span class="token token">'PUT'</span><span class="token token punctuation">,</span><span class="token token">'DELETE'</span><span class="token token punctuation">,</span><span class="token token">'OPTIONS'</span><span class="token token punctuation">]</span><span class="token token punctuation">,</span><span>
</span><span>  allowedHeaders</span><span class="token token operator">:</span><span></span><span class="token token punctuation">[</span><span class="token token">'Content-Type'</span><span class="token token punctuation">,</span><span class="token token">'Authorization'</span><span class="token token punctuation">]</span><span class="token token punctuation">,</span><span>
</span><span>  credentials</span><span class="token token operator">:</span><span></span><span class="token token boolean">true</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></code></span></div></div></div></pre>

## Production Configuration

Strict whitelist, caching, credentials:

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">typescript</div></div><div><span><code><span>app</span><span class="token token punctuation">.</span><span class="token token">use</span><span class="token token punctuation">(</span><span class="token token">cors</span><span class="token token punctuation">(</span><span class="token token punctuation">{</span><span>
</span><span>  origin</span><span class="token token operator">:</span><span> process</span><span class="token token punctuation">.</span><span>env</span><span class="token token punctuation">.</span><span class="token token constant">ALLOWED_ORIGINS</span><span class="token token operator">?.</span><span class="token token">split</span><span class="token token punctuation">(</span><span class="token token">','</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span>
</span><span>  methods</span><span class="token token operator">:</span><span></span><span class="token token punctuation">[</span><span class="token token">'GET'</span><span class="token token punctuation">,</span><span class="token token">'POST'</span><span class="token token punctuation">,</span><span class="token token">'PUT'</span><span class="token token punctuation">,</span><span class="token token">'DELETE'</span><span class="token token punctuation">,</span><span class="token token">'OPTIONS'</span><span class="token token punctuation">]</span><span class="token token punctuation">,</span><span>
</span><span>  allowedHeaders</span><span class="token token operator">:</span><span></span><span class="token token punctuation">[</span><span class="token token">'Content-Type'</span><span class="token token punctuation">,</span><span class="token token">'Authorization'</span><span class="token token punctuation">]</span><span class="token token punctuation">,</span><span>
</span><span>  credentials</span><span class="token token operator">:</span><span></span><span class="token token boolean">true</span><span class="token token punctuation">,</span><span>
</span><span>  maxAge</span><span class="token token operator">:</span><span></span><span class="token token">600</span><span class="token token punctuation">,</span><span>
</span><span>  exposedHeaders</span><span class="token token operator">:</span><span></span><span class="token token punctuation">[</span><span class="token token">'X-RateLimit-Remaining'</span><span class="token token punctuation">,</span><span class="token token">'X-Request-ID'</span><span class="token token punctuation">]</span><span>
</span><span></span><span class="token token punctuation">}</span><span class="token token punctuation">)</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></code></span></div></div></div></pre>

## Common Misconfigurations

## ❌ Allowing All Origins in Production

Using `origin: '*'` with `credentials: true` breaks browser security and exposes user sessions.

## ❌ Missing Credentials Configuration

Omitting `credentials: true` prevents cookies from being sent, breaking authentication flows.

## ❌ Incorrect Preflight Caching

Short or zero `maxAge` increases latency due to repeated OPTIONS calls.

## ❌ Not Handling All HTTP Methods

Failing to include OPTIONS or non-simple methods blocks legitimate requests.

## ❌ Overly Permissive Headers

Allowing all headers (`allowedHeaders: ['*']`) may expose sensitive internal header names.

## Security Best Practices

1. Always whitelist specific origins in production.
2. Use `Access-Control-Allow-Credentials: true` only when necessary.
3. Limit `Access-Control-Max-Age` to a reasonable caching window.
4. Restrict allowed methods and headers to the minimum required.
5. Enforce HTTPS to protect CORS communication.
6. Monitor CORS errors in logs and alert on repeated failures.

## Testing CORS Configuration

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">bash</div></div><div><span><code><span class="token token"># Preflight test</span><span>
</span><span></span><span class="token token">curl</span><span> -i -X OPTIONS </span><span class="token token">'https://api.example.com/data'</span><span></span><span class="token token punctuation">\</span><span>
</span><span>  -H </span><span class="token token">'Origin: https://app.example.com'</span><span></span><span class="token token punctuation">\</span><span>
</span><span>  -H </span><span class="token token">'Access-Control-Request-Method: POST'</span><span>
</span></code></span></div></div></div></pre>

<pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super selection:bg-super/10 my-md relative flex flex-col rounded font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0 items-start justify-end md:sticky md:top-[100px]"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest ring-subtlest divide-subtlest bg-subtler"><button data-testid="toggle-wrap-code-button" aria-label="Wrap lines" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l16 0 M4 18l5 0 M4 12h13a3 3 0 0 1 0 6h-4l2 -2m0 4l-2 -2"></path></svg></div></div></button><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0 items-center justify-center size-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" color="currentColor" class="tabler-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle py-xs px-sm inline-block rounded-br rounded-tl-[3px] font-thin">bash</div></div><div><span><code><span class="token token"># Credentialed request test</span><span>
</span><span></span><span class="token token">curl</span><span> -i </span><span class="token token">'https://api.example.com/user'</span><span></span><span class="token token punctuation">\</span><span>
</span><span>  -H </span><span class="token token">'Origin: https://app.example.com'</span><span></span><span class="token token punctuation">\</span><span>
</span><span>  -b </span><span class="token token">'session=abcd1234'</span><span>
</span></code></span></div></div></div></pre>

## Troubleshooting

* **Missing Access-Control-Allow-Origin** : Check middleware order and ensure CORS middleware runs before routes.
* **Credentials not sent** : Verify `withCredentials: true` on client, and server’s `Access-Control-Allow-Credentials: true`.
* **Blocked preflight** : Ensure OPTIONS handler is in place and returns 204.
* **Header not allowed** : Add missing header name to `allowedHeaders`.

## References

* MDN Web Docs – CORS
* OWASP CORS Cheat Sheet
* Express.js CORS Middleware Documentation
* W3C CORS Specification
* OWASP Top 10 – Security Misconfiguration

> End of CORS_CONFIGURATION.md (approx. 300 lines)
>
